i_uz <- unzip(ii, i_fl, exdir = temp_dir)
stopifnot(file.exists(i_uz))
i_csv <- read.csv(i_uz, header = T)
i_csv <- i_csv[which(i_csv$Station.Name == station_name), ]
break
}
head(i_csv)
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
head(i_csv)
colnames(i_csv)[grepl('X', colnames(i_csv))]
i_csv <- i_csv[, c('SKN', 'ELEV.m', 'LAT', 'LON', colnames(i_csv)[grepl('X', colnames(i_csv))])]
colnames(i_csv)
i_csv <- i_csv[, c('SKN', 'ELEV.m.', 'LAT', 'LON', colnames(i_csv)[grepl('X', colnames(i_csv))])]
head(i_csv)
i_csv <- read.csv(i_uz, header = T)
i_csv <- i_csv[which(i_csv$Station.Name == 'Laupahoehoe'), ]
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
i_csv <- i_csv[, c('Station.Name', 'Network', 'LAT', 'LON', colnames(i_csv)[grepl('X', colnames(i_csv))])]
head(i_csv)
?pivot_wider
?pivot_longer
colnames(i_csv)
i_csv <- tidyr::pivot_longer(i_csv, cols = c(5:ncol(i_csv)))
head(i_csv)
strsplit(i_csv$name, 'X')
sapply(strsplit(i_csv$name, 'X'), \(xx) xx[2])
i_csv$name <- sapply(strsplit(i_csv$name, 'X'), \(xx) xx[2])
head(i_csv)
sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[1])
i_csv$year <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[1])
i_csv$month <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[2])
head(i_csv)
i_csv <- within(i_csv, rm(name))
for (i in seq_along(clim_zips)) {
ii <- clim_zips[i]
i_l <- unzip(ii, list = T)[, 1]
i_fl <- i_l[grepl('\\.csv', i_l)]
i_uz <- unzip(ii, i_fl, exdir = temp_dir)
stopifnot(file.exists(i_uz))
i_csv <- read.csv(i_uz, header = T)
i_csv <- i_csv[which(i_csv$Station.Name == 'Laupahoehoe'), ]
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
i_csv <- i_csv[, c('Station.Name', 'Network', 'LAT', 'LON', colnames(i_csv)[grepl('X', colnames(i_csv))])]
i_csv <- tidyr::pivot_longer(i_csv, cols = c(5:ncol(i_csv)))
i_csv$name <- sapply(strsplit(i_csv$name, 'X'), \(xx) xx[2])
i_csv$year <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[1])
i_csv$month <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[2])
i_csv <- within(i_csv, rm(name))
break
}
head(i_csv)
for (i in seq_along(clim_zips)) {
ii <- clim_zips[i]
i_l <- unzip(ii, list = T)[, 1]
i_fl <- i_l[grepl('\\.csv', i_l)]
i_uz <- unzip(ii, i_fl, exdir = temp_dir)
stopifnot(file.exists(i_uz))
i_csv <- read.csv(i_uz, header = T)
i_csv <- i_csv[which(i_csv$Station.Name == 'Laupahoehoe'), ]
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
break
#i_csv <- i_csv[, c('Station.Name', colnames(i_csv)[grepl('X', colnames(i_csv))])]
i_csv <- tidyr::pivot_longer(i_csv, cols = c(2:ncol(i_csv)))
i_csv$name <- sapply(strsplit(i_csv$name, 'X'), \(xx) xx[2])
i_csv$year <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[1])
i_csv$month <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[2])
i_csv <- within(i_csv, rm(name))
break
}
head(i_csv)
colnames(i_csv)
for (i in seq_along(clim_zips)) {
ii <- clim_zips[i]
i_l <- unzip(ii, list = T)[, 1]
i_fl <- i_l[grepl('\\.csv', i_l)]
i_uz <- unzip(ii, i_fl, exdir = temp_dir)
stopifnot(file.exists(i_uz))
i_csv <- read.csv(i_uz, header = T)
i_csv <- i_csv[which(i_csv$Station.Name == 'Laupahoehoe'), ]
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
#i_csv <- i_csv[, c('Station.Name', colnames(i_csv)[grepl('X', colnames(i_csv))])]
i_csv <- tidyr::pivot_longer(i_csv, cols = c(14:ncol(i_csv)))
i_csv$name <- sapply(strsplit(i_csv$name, 'X'), \(xx) xx[2])
i_csv$year <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[1])
i_csv$month <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[2])
i_csv <- within(i_csv, rm(name))
break
}
head(i_csv)
clim_list <- lapply(clim_zips, \(xx) {
#for (i in seq_along(clim_zips)) {
#  ii <- clim_zips[i]
i_l <- unzip(xx, list = T)[, 1]
i_fl <- i_l[grepl('\\.csv', i_l)]
i_uz <- unzip(xx, i_fl, exdir = temp_dir)
stopifnot(file.exists(i_uz))
i_csv <- read.csv(i_uz, header = T)
i_csv <- i_csv[which(i_csv$Station.Name == 'Laupahoehoe'), ]
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
#i_csv <- i_csv[, c('Station.Name', colnames(i_csv)[grepl('X', colnames(i_csv))])]
i_csv <- tidyr::pivot_longer(i_csv, cols = c(14:ncol(i_csv)))
i_csv$name <- sapply(strsplit(i_csv$name, 'X'), \(yy) yy[2])
i_csv$year <- sapply(strsplit(i_csv$name, '\\.'), \(yy) yy[1])
i_csv$month <- sapply(strsplit(i_csv$name, '\\.'), \(yy) yy[2])
i_csv <- within(i_csv, rm(name))
})
traceback()
#clim_list <- lapply(clim_zips, \(ii) {
for (i in seq_along(clim_zips)) {
ii <- clim_zips[i]
i_l <- unzip(ii, list = T)[, 1]
i_fl <- i_l[grepl('\\.csv', i_l)]
i_uz <- unzip(ii, i_fl, exdir = temp_dir)
stopifnot(file.exists(i_uz))
i_csv <- read.csv(i_uz, header = T)
i_csv <- i_csv[which(i_csv$Station.Name == 'Laupahoehoe'), ]
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
#i_csv <- i_csv[, c('Station.Name', colnames(i_csv)[grepl('X', colnames(i_csv))])]
i_csv <- tidyr::pivot_longer(i_csv, cols = c(14:ncol(i_csv)))
i_csv$name <- sapply(strsplit(i_csv$name, 'X'), \(xx) yy[2])
i_csv$year <- sapply(strsplit(i_csv$name, '\\.'), \(xx) yy[1])
i_csv$month <- sapply(strsplit(i_csv$name, '\\.'), \(xx) yy[2])
i_csv <- within(i_csv, rm(name))
#})
}
#clim_list <- lapply(clim_zips, \(ii) {
for (i in seq_along(clim_zips)) {
ii <- clim_zips[i]
i_l <- unzip(ii, list = T)[, 1]
i_fl <- i_l[grepl('\\.csv', i_l)]
i_uz <- unzip(ii, i_fl, exdir = temp_dir)
stopifnot(file.exists(i_uz))
i_csv <- read.csv(i_uz, header = T)
i_csv <- i_csv[which(i_csv$Station.Name == 'Laupahoehoe'), ]
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
#i_csv <- i_csv[, c('Station.Name', colnames(i_csv)[grepl('X', colnames(i_csv))])]
i_csv <- tidyr::pivot_longer(i_csv, cols = c(14:ncol(i_csv)))
i_csv$name <- sapply(strsplit(i_csv$name, 'X'), \(xx) xx[2])
i_csv$year <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[1])
i_csv$month <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[2])
i_csv <- within(i_csv, rm(name))
#})
}
i
ii
i_l <- unzip(ii, list = T)[, 1]
i)l
i_l
i_fl <- i_l[grepl('\\.csv', i_l)]
i_fl
i_uz <- unzip(ii, i_fl, exdir = temp_dir)
i_uz
i_csv <- sapply(i_uz, read.csv)
i_csv
climate_dir <- '/home/bem/Documents/HIPPNET/HDCP/22July2023'
temp_dir <- tempdir()
clim_zips <- list.files(climate_dir, pattern = '\\.zip', full.names = T)
#clim_list <- lapply(clim_zips, \(ii) {
for (i in seq_along(clim_zips)) {
ii <- clim_zips[i]
i_l <- unzip(ii, list = T)[, 1]
i_fl <- i_l[grepl('\\.csv', i_l)]
i_uz <- unzip(ii, i_fl, exdir = temp_dir)
stopifnot(file.exists(i_uz))
i_csv <- sapply(i_uz, read.csv)
break
i_csv <- i_csv[which(i_csv$Station.Name == 'Laupahoehoe'), ]
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
#i_csv <- i_csv[, c('Station.Name', colnames(i_csv)[grepl('X', colnames(i_csv))])]
i_csv <- tidyr::pivot_longer(i_csv, cols = c(14:ncol(i_csv)))
i_csv$name <- sapply(strsplit(i_csv$name, 'X'), \(xx) xx[2])
i_csv$year <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[1])
i_csv$month <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[2])
i_csv <- within(i_csv, rm(name))
#})
}
head(i_csv)
i_csv
#clim_list <- lapply(clim_zips, \(ii) {
for (i in seq_along(clim_zips)) {
ii <- clim_zips[i]
i_l <- unzip(ii, list = T)[, 1]
i_fl <- i_l[grepl('\\.csv', i_l)]
i_uz <- unzip(ii, i_fl, exdir = temp_dir)
stopifnot(file.exists(i_uz))
# only works with one csv at a time
i_csv <- read.csv(i_uz)
i_csv <- i_csv[which(i_csv$Station.Name == 'Laupahoehoe'), ]
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
#i_csv <- i_csv[, c('Station.Name', colnames(i_csv)[grepl('X', colnames(i_csv))])]
i_csv <- tidyr::pivot_longer(i_csv, cols = c(14:ncol(i_csv)))
i_csv$name <- sapply(strsplit(i_csv$name, 'X'), \(xx) xx[2])
i_csv$year <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[1])
i_csv$month <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[2])
i_csv <- within(i_csv, rm(name))
#})
}
head(i_csv)
View(i_csv)
clim_list <- lapply(clim_zips, \(ii) {
#for (i in seq_along(clim_zips)) {
#ii <- clim_zips[i]
i_l <- unzip(ii, list = T)[, 1]
i_fl <- i_l[grepl('\\.csv', i_l)]
i_uz <- unzip(ii, i_fl, exdir = temp_dir)
stopifnot(file.exists(i_uz))
# only works with one csv at a time
i_csv <- read.csv(i_uz)
i_csv <- i_csv[which(i_csv$Station.Name == 'Laupahoehoe'), ]
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
#i_csv <- i_csv[, c('Station.Name', colnames(i_csv)[grepl('X', colnames(i_csv))])]
i_csv <- tidyr::pivot_longer(i_csv, cols = c(14:ncol(i_csv)))
i_csv$name <- sapply(strsplit(i_csv$name, 'X'), \(xx) xx[2])
i_csv$year <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[1])
i_csv$month <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[2])
i_csv <- within(i_csv, rm(name))
})
clim_df <- do.call('rbind', clim_list)
View(clim_df)
rm(list = ls())
gc()
ppt_list <- lapply(clim_zips, \(ii) {
#for (i in seq_along(clim_zips)) {
#ii <- clim_zips[i]
i_l <- unzip(ii, list = T)[, 1]
i_fl <- i_l[grepl('\\.csv', i_l)]
i_uz <- unzip(ii, i_fl, exdir = temp_dir)
stopifnot(file.exists(i_uz))
# only works with one csv at a time
i_csv <- read.csv(i_uz)
i_csv <- i_csv[which(i_csv$Station.Name == 'Laupahoehoe'), ]
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
#i_csv <- i_csv[, c('Station.Name', colnames(i_csv)[grepl('X', colnames(i_csv))])]
i_csv <- tidyr::pivot_longer(i_csv, cols = c(14:ncol(i_csv)))
i_csv$name <- sapply(strsplit(i_csv$name, 'X'), \(xx) xx[2])
i_csv$year <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[1])
i_csv$month <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[2])
i_csv <- within(i_csv, rm(name))
})
climate_dir <- '/home/bem/Documents/HIPPNET/HDCP/22July2023'
temp_dir <- tempdir()
clim_dir <- '/home/bem/Documents/HIPPNET/HDCP/PPT_22July2023'
temp_dir <- tempdir()
ppt_dir <- '/home/bem/Documents/HIPPNET/HDCP/PPT_22July2023'
T_dir <- '/home/bem/Documents/HIPPNET/HDCP/T_22July2023'
temp_dir <- tempdir()
ppt_zips <- list.files(ppt_dir, pattern = '\\.zip', full.names = T)
T_zips <- list.files(T_dir, pattern = '\\.zip', full.names = T)
ppt_dir <- '/home/bem/Documents/HIPPNET/HDCP/PPT_22July2023'
T_dir <- '/home/bem/Documents/HIPPNET/HDCP/maxT_22July2023'
temp_dir <- tempdir()
ppt_zips <- list.files(ppt_dir, pattern = '\\.zip', full.names = T)
maxT_zips <- list.files(maxT_dir, pattern = '\\.zip', full.names = T)
T_dir <- '/home/bem/Documents/HIPPNET/HDCP/maxT_22July2023'
temp_dir <- tempdir()
ppt_zips <- list.files(ppt_dir, pattern = '\\.zip', full.names = T)
maxT_zips <- list.files(maxT_dir, pattern = '\\.zip', full.names = T)
maxT_dir <- '/home/bem/Documents/HIPPNET/HDCP/maxT_22July2023'
maxT_zips <- list.files(maxT_dir, pattern = '\\.zip', full.names = T)
rm(list = ls())
ppt_dir <- '/home/bem/Documents/HIPPNET/HDCP/PPT_22July2023'
maxT_dir <- '/home/bem/Documents/HIPPNET/HDCP/maxT_22July2023'
temp_dir <- tempdir()
ppt_zips <- list.files(ppt_dir, pattern = '\\.zip', full.names = T)
maxT_zips <- list.files(maxT_dir, pattern = '\\.zip', full.names = T)
ppt_list <- lapply(ppt_zips, \(ii) {
#for (i in seq_along(clim_zips)) {
#ii <- clim_zips[i]
i_l <- unzip(ii, list = T)[, 1]
i_fl <- i_l[grepl('\\.csv', i_l)]
i_uz <- unzip(ii, i_fl, exdir = temp_dir)
stopifnot(file.exists(i_uz))
# only works with one csv at a time
i_csv <- read.csv(i_uz)
i_csv <- i_csv[which(i_csv$Station.Name == 'Laupahoehoe'), ]
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
#i_csv <- i_csv[, c('Station.Name', colnames(i_csv)[grepl('X', colnames(i_csv))])]
i_csv <- tidyr::pivot_longer(i_csv, cols = c(14:ncol(i_csv)))
i_csv$name <- sapply(strsplit(i_csv$name, 'X'), \(xx) xx[2])
i_csv$year <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[1])
i_csv$month <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[2])
i_csv <- within(i_csv, rm(name))
})
maxT_list <- lapply(maxT_zips, \(ii) {
i_l <- unzip(ii, list = T)[, 1]
i_fl <- i_l[grepl('\\.csv', i_l)]
i_uz <- unzip(ii, i_fl, exdir = temp_dir)
stopifnot(file.exists(i_uz))
i_csv <- read.csv(i_uz)
i_csv <- i_csv[which(i_csv$Station.Name == 'Laupahoehoe'), ]
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
i_csv <- tidyr::pivot_longer(i_csv, cols = c(14:ncol(i_csv)))
i_csv$name <- sapply(strsplit(i_csv$name, 'X'), \(xx) xx[2])
i_csv$year <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[1])
i_csv$month <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[2])
i_csv <- within(i_csv, rm(name))
})
maxT_list <- lapply(maxT_zips, \(ii) {
i_l <- unzip(ii, list = T)[, 1]
i_fl <- i_l[grepl('\\.csv', i_l)]
i_uz <- unzip(ii, i_fl, exdir = temp_dir)
stopifnot(file.exists(i_uz))
i_csv <- read.csv(i_uz)
i_csv <- i_csv[which(i_csv$Station.Name == 'Laupahoehoe'), ]
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
i_csv <- tidyr::pivot_longer(i_csv, cols = c(14:ncol(i_csv)))
break
i_csv$name <- sapply(strsplit(i_csv$name, 'X'), \(xx) xx[2])
i_csv$year <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[1])
i_csv$month <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[2])
i_csv <- within(i_csv, rm(name))
})
maxT_list <- lapply(maxT_zips, \(ii) {
i_l <- unzip(ii, list = T)[, 1]
i_fl <- i_l[grepl('\\.csv', i_l)]
i_uz <- unzip(ii, i_fl, exdir = temp_dir)
stopifnot(file.exists(i_uz))
i_csv <- read.csv(i_uz)
i_csv <- i_csv[which(i_csv$Station.Name == 'Laupahoehoe'), ]
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
i_csv <- tidyr::pivot_longer(i_csv, cols = c(14:ncol(i_csv)))
browser()
i_csv$name <- sapply(strsplit(i_csv$name, 'X'), \(xx) xx[2])
i_csv$year <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[1])
i_csv$month <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[2])
i_csv <- within(i_csv, rm(name))
})
head(i_csv)
i_csv
i
ii
i_l
i_fl
i_uz
i_csv <- read.csv(i_uz)
head(i_csv)
unique(i_csv$Station.Name)
sort(unique(i_csv$Station.Name))
head(i_csv)
i_csv[which(i_csv$Network == 'HIPPNET'), ]
View(i_csv)
# this was just a guess on google maps, need better decimal longitude coordinates
approx_lat <- 19.9194
appox_lon <- -155.3045
i_csv$LAT - approx_lat
abs(i_csv$LAT - approx_lat)
abs(i_csv$LAT - approx_lat) + (abs(i_csv$LON - approx_lon))
abs(i_csv$LAT - approx_lat) + (abs(i_csv$LON - approx_lon))
appox_lon <- 155.3045
abs(i_csv$LAT - approx_lat) + abs(abs(i_csv$LON - approx_lon))
approx_lon <- 155.3045
abs(i_csv$LAT - approx_lat) + abs(abs(i_csv$LON - approx_lon))
abs(i_csv$LAT - approx_lat)
abs(i_csv$LAT - approx_lat) + abs(abs(i_csv$LON) - approx_lon)
which.min(abs(i_csv$LAT - approx_lat) + abs(abs(i_csv$LON) - approx_lon))
i_csv[35, ]
which.min(abs(i_csv$LAT - approx_lat) + abs(abs(i_csv$LON) - approx_lon) + abs(i_csv$ELEV.m. - approx_elv))
approx_elev <- 1160
which.min(abs(i_csv$LAT - approx_lat) + abs(abs(i_csv$LON) - approx_lon) + abs(i_csv$ELEV.m. - approx_elv))
which.min(abs(i_csv$LAT - approx_lat) + abs(abs(i_csv$LON) - approx_lon) + abs(i_csv$ELEV.m. - approx_elev))
i_csv[39, ]
View(i_csv)
test0 <- i_csv[order(i_csv$Station.Name), ]
View(i_csv)
test0 <- i_csv[sort(i_csv$Station.Name), ]
View(test0)
View(i_csv)
View(test0)
test0 <- i_csv[order(i_csv$Station.Name), ]
View(test0)
rm(list = ls())
gc()
# BEM July 2023
ppt_dir <- '/home/bem/Documents/HIPPNET/HDCP/PPT_22July2023'
#maxT_dir <- '/home/bem/Documents/HIPPNET/HDCP/maxT_22July2023'
ppt_list <- lapply(ppt_zips, \(ii) {
#for (i in seq_along(clim_zips)) {
#ii <- clim_zips[i]
i_l <- unzip(ii, list = T)[, 1]
i_fl <- i_l[grepl('\\.csv', i_l)]
i_uz <- unzip(ii, i_fl, exdir = temp_dir)
stopifnot(file.exists(i_uz))
# only works with one csv at a time
i_csv <- read.csv(i_uz)
i_csv <- i_csv[which(i_csv$Station.Name == 'Laupahoehoe'), ]
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
i_csv <- i_csv[, c('Station.Name', colnames(i_csv)[grepl('X', colnames(i_csv))])]
i_csv <- tidyr::pivot_longer(i_csv, cols = c(14:ncol(i_csv)))
i_csv$name <- sapply(strsplit(i_csv$name, 'X'), \(xx) xx[2])
i_csv$year <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[1])
i_csv$month <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[2])
i_csv <- within(i_csv, rm(name))
})
ppt_list <- lapply(ppt_zips, \(ii) {
#for (i in seq_along(clim_zips)) {
#ii <- clim_zips[i]
i_l <- unzip(ii, list = T)[, 1]
i_fl <- i_l[grepl('\\.csv', i_l)]
i_uz <- unzip(ii, i_fl, exdir = temp_dir)
stopifnot(file.exists(i_uz))
# only works with one csv at a time
i_csv <- read.csv(i_uz)
i_csv <- i_csv[which(i_csv$Station.Name == 'Laupahoehoe'), ]
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
#i_csv <- i_csv[, c('Station.Name', colnames(i_csv)[grepl('X', colnames(i_csv))])]
i_csv <- tidyr::pivot_longer(i_csv, cols = c(14:ncol(i_csv)))
i_csv$name <- sapply(strsplit(i_csv$name, 'X'), \(xx) xx[2])
i_csv$year <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[1])
i_csv$month <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[2])
i_csv <- within(i_csv, rm(name))
})
ppt_df <- do.call('rbind', clim_list)
ppt_df <- do.call('rbind', ppt_list)
head(ppt_df)
View(ppt_df)
View(ppt_df)
ppt_df <- ppt_df[, c('Station.Name', 'value', 'year', 'month')]
View(ppt_df)
aggregate(ppt_df$value, by = list(ppt_df$year, FUN = sum))
aggregate(ppt_df$value, by = list(ppt_df$year), FUN = sum)
head(ppt_df)
data_dir <- '../data'
# aggregate(ppt_df$value, by = list(ppt_df$year), FUN = sum)
write.csv(ppt_df, file.path(data_dir, 'PPT_Laupahoehoe.csv'))
head(ppt_df)
# get climate data
ppt_df <- read.csv(file.path(data_dir, 'PPT_Laupahoehoe.csv'))
# get climate data
ppt_df <- read.csv(file.path(data_dir, 'PPT_Laupahoehoe.csv'), row.names = F)
rm(list = ls())
gc()
# BEM July 2023
ppt_dir <- '/home/bem/Documents/HIPPNET/HDCP/PPT_22July2023'
data_dir <- '../data'
#maxT_dir <- '/home/bem/Documents/HIPPNET/HDCP/maxT_22July2023'
#temp_dir <- tempdir()
ppt_zips <- list.files(ppt_dir, pattern = '\\.zip', full.names = T)
#maxT_zips <- list.files(maxT_dir, pattern = '\\.zip', full.names = T)
ppt_list <- lapply(ppt_zips, \(ii) {
#for (i in seq_along(clim_zips)) {
#ii <- clim_zips[i]
i_l <- unzip(ii, list = T)[, 1]
i_fl <- i_l[grepl('\\.csv', i_l)]
i_uz <- unzip(ii, i_fl, exdir = temp_dir)
stopifnot(file.exists(i_uz))
# only works with one csv at a time
i_csv <- read.csv(i_uz)
i_csv <- i_csv[which(i_csv$Station.Name == 'Laupahoehoe'), ]
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
#i_csv <- i_csv[, c('Station.Name', colnames(i_csv)[grepl('X', colnames(i_csv))])]
i_csv <- tidyr::pivot_longer(i_csv, cols = c(14:ncol(i_csv)))
i_csv$name <- sapply(strsplit(i_csv$name, 'X'), \(xx) xx[2])
i_csv$year <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[1])
i_csv$month <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[2])
i_csv <- within(i_csv, rm(name))
})
temp_dir <- tempdir()
ppt_dir <- '/home/bem/Documents/HIPPNET/HDCP/PPT_22July2023'
data_dir <- '../data'
#maxT_dir <- '/home/bem/Documents/HIPPNET/HDCP/maxT_22July2023'
#temp_dir <- tempdir()
ppt_zips <- list.files(ppt_dir, pattern = '\\.zip', full.names = T)
#maxT_zips <- list.files(maxT_dir, pattern = '\\.zip', full.names = T)
ppt_list <- lapply(ppt_zips, \(ii) {
#for (i in seq_along(clim_zips)) {
#ii <- clim_zips[i]
i_l <- unzip(ii, list = T)[, 1]
i_fl <- i_l[grepl('\\.csv', i_l)]
i_uz <- unzip(ii, i_fl, exdir = temp_dir)
stopifnot(file.exists(i_uz))
# only works with one csv at a time
i_csv <- read.csv(i_uz)
i_csv <- i_csv[which(i_csv$Station.Name == 'Laupahoehoe'), ]
i_csv <- i_csv[which(i_csv$Network == 'HIPPNET'), ]
#i_csv <- i_csv[, c('Station.Name', colnames(i_csv)[grepl('X', colnames(i_csv))])]
i_csv <- tidyr::pivot_longer(i_csv, cols = c(14:ncol(i_csv)))
i_csv$name <- sapply(strsplit(i_csv$name, 'X'), \(xx) xx[2])
i_csv$year <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[1])
i_csv$month <- sapply(strsplit(i_csv$name, '\\.'), \(xx) xx[2])
i_csv <- within(i_csv, rm(name))
})
ppt_df <- do.call('rbind', ppt_list)
ppt_df <- ppt_df[, c('Station.Name', 'value', 'year', 'month')]
# aggregate(ppt_df$value, by = list(ppt_df$year), FUN = sum)
write.csv(ppt_df, file.path(data_dir, 'PPT_Laupahoehoe.csv'), row.names = F)
rm(list = ls)
rm(list = ls())
gc()
# get climate data
ppt_df <- read.csv(file.path(data_dir, 'PPT_Laupahoehoe.csv'), row.names = NULL)
rm(list = ls())
gc()
data_dir <- '../data'
# get demography data
LAU <- read.csv(file.path(data_dir, 'LAU_processed.csv'))
# need to only use mainstems
LAU <- LAU[which(LAU$mstem == 0), ]
# get DEM covariates
LAU_TRI <- terra::rast(file.path(data_dir, 'LAU_TRI.tif'))
LAU_TWI <- terra::rast(file.path(data_dir, 'LAU_TWI.tif'))
LAU_rad <- terra::rast(file.path(data_dir, 'LAU_rad.tif'))
LAU_wind <- terra::rast(file.path(data_dir, 'LAU_wind.tif'))
LAU$TRI <- terra::extract(LAU_TRI, LAU[, c('x', 'y')])[, 2]
LAU$TWI <- terra::extract(LAU_TWI, LAU[, c('x', 'y')])[, 2]
LAU$rad <- terra::extract(LAU_rad, LAU[, c('x', 'y')])[, 2]
LAU$wind <- terra::extract(LAU_wind, LAU[, c('x', 'y')])[, 2]
# get climate data
ppt_df <- read.csv(file.path(data_dir, 'PPT_Laupahoehoe.csv'), row.names = NULL)
head(ppt_df)
head(LAU)
rm(list = ls())
gc()
